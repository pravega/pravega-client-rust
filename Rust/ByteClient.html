<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Byte Client - Pravega Native Client</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../quickStart.html"><strong aria-hidden="true">2.</strong> QuickStart</a></li><li class="chapter-item expanded "><a href="../Rust/index.html"><strong aria-hidden="true">3.</strong> Rust Client</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Rust/EventClient.html"><strong aria-hidden="true">3.1.</strong> Event Client</a></li><li class="chapter-item expanded "><a href="../Rust/ByteClient.html" class="active"><strong aria-hidden="true">3.2.</strong> Byte Client</a></li><li class="chapter-item expanded "><a href="../Rust/contribution.html"><strong aria-hidden="true">3.3.</strong> Developer Corner</a></li></ol></li><li class="chapter-item expanded "><a href="../Nodejs/index.html"><strong aria-hidden="true">4.</strong> Nodejs Client</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Nodejs/NodejsBindings.html"><strong aria-hidden="true">4.1.</strong> Nodejs Bindings</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Pravega Native Client</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#byte-client" id="byte-client">Byte Client</a></h1>
<p>Unlike EventWriter, ByteWriter writes raw bytes into Pravega Stream
without adding any headers or encoding. This means that the data stored in the Stream is a continuous
stream of bytes. Because of that, data written by ByteWriter can only be read by
ByteReader. </p>
<p>The Byte Client is useful in cases where a raw stream of bytes is desirable such as video streaming.</p>
<h2><a class="header" href="#example-walkthrough" id="example-walkthrough">Example walkthrough</a></h2>
<h3><a class="header" href="#create-a-clientfactory" id="create-a-clientfactory">Create a ClientFactory</a></h3>
<p>Applications should use <code>ClientFactory</code> to initialize components. The client doesn't expose
the underlying <code>new</code> method to users.</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// assuming pravega controller is listening at localhost:9090
let config = ClientConfigBuilder::default()
    .controller_uri(&quot;localhost:9090&quot;)
    .build()
    .expect(&quot;creating config&quot;);

let client_factory = ClientFactory::new(config);
<span class="boring">}
</span></code></pre></pre>
<h3><a class="header" href="#create-a-byte-writer" id="create-a-byte-writer">Create a Byte Writer</a></h3>
<p>Assuming a new stream <code>mystream</code> has been created under scope <code>myscope</code> and
it contains a segment whose segmentId is 0.</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let segment = ScopedSegment::from(&quot;myscope/mystream/0&quot;);
let mut byte_writer = client_factory.create_byte_writer(segment);
<span class="boring">}
</span></code></pre></pre>
<h3><a class="header" href="#seek-to-tail" id="seek-to-tail">Seek to tail</a></h3>
<p>Sometimes applications use Byte Writer to write to a segment that 
contains some preexisting data. In this case, we need to find out
the tail offset of the segment first.</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>byte_writer.seek_to_tail();
<span class="boring">}
</span></code></pre></pre>
<h3><a class="header" href="#write-some-data" id="write-some-data">Write some data</a></h3>
<p>It doesn't mean the data is persisted on the server side
when write method returns <code>Ok()</code>, user should call <code>writer.flush()</code> to ensure
all data has been acknowledged by the server.</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let payload = &quot;hello world&quot;.to_string().into_bytes();
byte_writer.write(&amp;payload).expect(&quot;write&quot;);
byte_writer.flush().expect(&quot;flush&quot;);
<span class="boring">}
</span></code></pre></pre>
<h3><a class="header" href="#truncate-the-segment" id="truncate-the-segment">Truncate the segment</a></h3>
<p><code>ByteWriter</code> can also truncate the segment. Truncation means that the
data prior to some offset is not needed anymore. Truncated data cannot be read. 
Applications use truncation to save space on the server.</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>byte_writer.truncate_data_before(4).await.expect(&quot;truncate segment&quot;);
<span class="boring">}
</span></code></pre></pre>
<h3><a class="header" href="#seal-the-segment" id="seal-the-segment">Seal the segment</a></h3>
<p>Sealing a segment is basically to make a segment read-only.</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>byte_writer.seal().await.expect(&quot;seal segment&quot;);
<span class="boring">}
</span></code></pre></pre>
<h3><a class="header" href="#create-a-byte-reader" id="create-a-byte-reader">Create a Byte Reader</a></h3>
<p>Create a <code>ByteReader</code> to read the same segment we just write.</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let segment = ScopedSegment::from(&quot;myscope/mystream/0&quot;);
let mut byte_reader = client_factory.create_byte_reader(segment);
<span class="boring">}
</span></code></pre></pre>
<h3><a class="header" href="#read-from-an-offset" id="read-from-an-offset">Read from an offset</a></h3>
<p><code>ByteReader</code> can seek to any offset in the segment and read from it. It also 
provides a useful method to show the current head of the readable offset. Remember that 
the truncated data is not readable anymore, so the current head of the readable offset
is the truncation offset.</p>
<p><code>read</code> method will block until some data are fetched from the server. If returned <code>size</code> is 0,
then it reaches the end of segment and no more data could be read from this offset.</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>let offset = byte_reader.current_head().await.expect(&quot;get current head offset&quot;);
let mut buf: Vec&lt;u8&gt; = vec![0; 4];
let size = byte_reader.read(&amp;mut buf).await.expect(&quot;read from byte stream&quot;);
<span class="boring">}
</span></code></pre></pre>
<h3><a class="header" href="#put-it-together" id="put-it-together">Put it together</a></h3>
<pre><pre class="playground"><code class="language-rust">use pravega_client_config::ClientConfigBuilder;
use pravega_client::client_factory::ClientFactory;
use pravega_client_shared::ScopedSegment;
use std::io::Write;

#[tokio::main]
async fn main() {
    let config = ClientConfigBuilder::default()
     .controller_uri(&quot;localhost:9090&quot;)
     .build()
     .expect(&quot;creating config&quot;);
    
    let client_factory = ClientFactory::new(config);
    
    let segment = ScopedSegment::from(&quot;myscope/mystream/0&quot;);
    
    // write
    let mut byte_writer = client_factory.create_byte_writer(segment);
    byte_writer.seek_to_tail().await;
    
    let payload = &quot;hello world&quot;.to_string().into_bytes();
    
    byte_writer.write(&amp;payload).await.expect(&quot;write&quot;);
    byte_writer.flush().await.expect(&quot;flush&quot;);

    byte_writer.truncate_data_before(4).await.expect(&quot;truncate segment&quot;);

    byte_writer.seal().await.expect(&quot;seal segment&quot;);

    // read
    let segment = ScopedSegment::from(&quot;myscope/mystream/0&quot;);
    let mut byte_reader = client_factory.create_byte_reader(segment).await;

    let offset = byte_reader.current_head().await.expect(&quot;get current head offset&quot;);
    let mut buf: Vec&lt;u8&gt; = vec![0; 4];
    let size = byte_reader.read(&amp;mut buf).await.expect(&quot;read from byte stream&quot;);
}
</code></pre></pre>
<p>For more details please refer <a href="../doc/pravega_client/byte">API docs</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../Rust/EventClient.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../Rust/contribution.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../Rust/EventClient.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../Rust/contribution.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        
        <script type="text/javascript">
            window.playground_line_numbers = true;
        </script>
        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        
        <script src="../ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="../editor.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mode-rust.js" type="text/javascript" charset="utf-8"></script>
        <script src="../theme-dawn.js" type="text/javascript" charset="utf-8"></script>
        <script src="../theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>
        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
